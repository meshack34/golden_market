{# templates/tour/booking_pdf.html #}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Booking {{ booking.id }}</title>
  <style>
    /* -------- Reset / Base -------- */
    @page { size: A4; margin: 18mm 14mm 18mm 14mm; }
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      font-size: 12px; color: #222;
    }
    h1, h2, h3 { margin: 0 0 8px; }
    h1 { font-size: 20px; color: #0056b3; border-bottom: 2px solid #0056b3; padding-bottom: 4px; }
    h2 { font-size: 16px; margin-top: 14px; color: #0056b3; }
    h3 { font-size: 13px; margin-top: 10px; }
    p { margin: 0 0 6px; }
    .muted { color: #666; }
    .fw-bold { font-weight: 700; }
    .text-right { text-align: right; }
    .mb-10 { margin-bottom: 10px; }

    /* -------- Layout -------- */
    .row { display: flex; gap: 18px; }
    .col-8 { flex: 2 1 0; min-width: 0; }
    .col-4 { flex: 1 1 0; min-width: 0; }
    .section { break-inside: avoid; margin-bottom: 14px; }

    /* -------- Tables -------- */
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th, td { padding: 6px 8px; border: 1px solid #ddd; vertical-align: top; }
    thead th {
      background: #eaf3ff;
      color: #0056b3;
      font-weight: 600;
    }
    tbody tr:nth-child(even) { background: #fafafa; }
    tbody tr.fw-bold td {
      background: #0056b3;
      color: #fff;
      font-weight: 700;
    }

    /* -------- Cards -------- */
    .card {
      border: 1px solid #dbe4f3;
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 10px;
      background: #f9fbff;
    }
    .card-title {
      text-align: center;
      font-weight: 600;
      margin-bottom: 6px;
      color: #0056b3;
    }

    /* -------- Images -------- */
    .thumb-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
    .thumb { width: 100%; height: 90px; object-fit: cover; border-radius: 4px; }
    .banner { width: 100%; height: 140px; object-fit: cover; border-radius: 6px; }

    /* -------- Page breaks -------- */
    .page-break { page-break-before: always; }

    /* Footer */
    .footer { position: running(footer); font-size: 10px; color: #555; text-align: center; }
    @page {
      @bottom-center { content: element(footer); }
    }
  </style>
</head>
<body>

  <div class="footer">Generated by TMS â€¢ Booking #{{ booking.id }}</div>

  <h1>Booking Details</h1>

  <div class="row">
    <!-- LEFT COLUMN -->
    <div class="col-8">
      <h3>Client: {{ booking.client.name }}</h3>
      <p><span class="fw-bold">Start Date:</span> {{ booking.start_date }}</p>
      <p class="mb-10"><span class="fw-bold">End Date:</span> {{ booking.end_date }}</p>

      <!-- Cost Breakdown -->
      <div class="section">
        <h2>Cost Breakdown</h2>
        <table>
          <thead>
            <tr>
              <th>Category</th>
              <th class="text-right">Cost</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Accommodation</td><td class="text-right">${{ breakdown.Accommodation }}</td></tr>
            <tr><td>Activities</td><td class="text-right">${{ breakdown.Activities }}</td></tr>
            <tr><td>Dining</td><td class="text-right">${{ breakdown.Dining }}</td></tr>
            <tr><td>Transport</td><td class="text-right">${{ breakdown.Transport }}</td></tr>
            <tr class="fw-bold"><td>Total</td><td class="text-right">${{ breakdown.Total }}</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Travel Itinerary -->
      <div class="section">
        <h2>Travel Itinerary</h2>
        {% if travel_legs %}
        <table>
          <thead>
            <tr>
              <th style="width:70px;">Date</th>
              <th style="width:60px;">Mode</th>
              <th>From</th>
              <th>To</th>
              <th style="width:70px;" class="text-right">Cost</th>
            </tr>
          </thead>
          <tbody>
            {% for leg in travel_legs %}
            <tr>
              <td>{{ leg.date }}</td>
              <td>{{ leg.mode }}</td>
              <td>{{ leg.from_location }}{% if leg.from_destination %} ({{ leg.from_destination.name }}){% endif %}</td>
              <td>{{ leg.to_location }}{% if leg.to_destination %} ({{ leg.to_destination.name }}){% endif %}</td>
              <td class="text-right">${{ leg.cost }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <p class="muted">No travel legs added yet.</p>
        {% endif %}
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="col-4">
      <!-- Destinations -->
      <div class="section">
        <h2>Destinations</h2>
        {% for d in destinations %}
          <div class="card">
            <div class="card-title">{{ d.name }}</div>
            {% if d.galleries.all %}
              <div class="thumb-grid">
                {% for g in d.galleries.all|slice:":3" %}
                  {% if g.image %}
                    <img src="{{ g.image.url }}" class="thumb" alt="{{ d.name }}">
                  {% endif %}
                {% endfor %}
              </div>
            {% else %}
              <p class="muted">No images uploaded.</p>
            {% endif %}
          </div>
        {% empty %}
          <p class="muted">No destinations added yet.</p>
        {% endfor %}
      </div>

      <!-- Restaurants -->
      <div class="section">
        <h2>Restaurants</h2>
        {% with all_dests=destinations %}
          {% for d in all_dests %}
            {% for r in d.restaurants.all %}
              <div class="card">
                {% if r.image %}
                  <img src="{{ r.image.url }}" class="banner" alt="{{ r.name }}">
                {% endif %}
                <div class="card-title">{{ r.name }}</div>
                <div class="muted" style="text-align:center;">{{ d.name }}</div>
              </div>
            {% endfor %}
          {% endfor %}
          {% if not has_restaurants %}
            <p class="muted">No restaurants added yet.</p>
          {% endif %}
        {% endwith %}
      </div>
    </div>
  </div>

</body>
</html>
